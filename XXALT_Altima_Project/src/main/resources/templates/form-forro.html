<form class="row" th:object="${forro}" name="forroForm" id="forroForm" th:action="@{/guardar-forro}" enctype="multipart/form-data" method="post">
	  
    <div class="form-group col-sm-5">
        <label for="razonEmpresa">Porcentaje</label>
        <input type="number" min="1"  id="telaComposicionf" class="form-control"  placeholder="100">
    </div>
    <div class="form-group col-md-6">
        <label for="status">Composici&oacute;n</label>
        <select id="telaFamcomposicionf" class="form-control selectCustom" data-live-search="true">
        	<option value="">Selecciona uno...</option>
        	<option th:each="lisCom: ${lisCom}"
			th:value="${lisCom.idLookup}" th:text="${lisCom.nombreLookup}"></option>
            
        </select>
    </div>
     <div class="form-group col-sm-1">
     <label for="status">Agregar</label>
        <button id="adicionarf" onclick="guardarf()" class="btn btn-info rounded-circle" type="button"><i class="fas fa-plus"></i></button>
        
    </div>
     <div class="form-group col-sm-12">
        <table id="mytablef" class="table table-striped">
        	<tr>
    			<th>Porcentaje</th>
    			<th style="display:none;"></th>
    			<th>Composicion</th>
    			<th>Eliminar</th>

  			</tr>
  		<thead>
  			<tbody>
                                            <tr th:each="listForroComposicon: ${listForroComposicon}">
                                               
                                                <td th:text="${listForroComposicon[0]}"></td>
                                                <td  style="display:none;"th:text="${listForroComposicon[1]}"></td>
                                                <td  th:text="${listForroComposicon[2]}"></td>
                                                <td  > <button type="button" name="remove" onclick="eliminar(this)" class="btn btn-danger btn_remove">Quitar</button></td>
                                               
                                            </tr>     
             </tbody>
        </table>
    </div>
	<div class="form-group col-sm-6">
        <label for="razonEmpresa">Nombre</label>
        <input type="text" th:field="*{nombreForro}" class="form-control" id="forroNombre" placeholder="Forro" required>
    </div>
	
	<div class="form-group col-sm-6">
        <label for="razonEmpresa">Descripci&oacute;n</label>
        <input type="text" th:field="*{descripcionForro}"  class="form-control" id="forroDescripcion" placeholder="Descripci&oacute;n" required>
    </div>
    
    
    <div class="form-group col-sm-4">
        <label for="rfcEmpresa">Ancho(m)</label>
        <input th:field="*{anchoForro}"  type="number" min="1" step="any" class="form-control"  placeholder="1.2" required>
    </div>
    <div class="form-group col-sm-4">
        <label for="status">Color</label>
        <input type="text" th:field="*{color}" required class="form-control" placeholder="Rojo">
    </div>
    
    <div class="form-group col-sm-4">
        <label for="status">C&oacute;digo Color</label>
        <input required th:field="*{codigo_coolor}" type="color"  class="form-control" placeholder="Codigo Color">
    </div>
    
    <div th:if="*{estatusForro  == '1'}" class="form-group col-sm-6">      
        <label for="status">Unidad de medida</label>
        <select required class="form-control selectCustom"   th:field="*{idUnidadMedida}" data-live-search="true">
       <option th:each="listLookupsMed:${listLookupsMed}"
            
                    th:value="${listLookupsMed[0]}"
                    th:text="${listLookupsMed[1]}"
            
            />
            </select>
    </div>
    
    
    
    <div th:if="*{estatusForro  == '1'}"  class="form-group col-sm-6">
        <label for="rfcEmpresa">Existencias</label>
        <input th:field="*{existenciaForro}"  type="number" min="0"  class="form-control"  placeholder="10" required>
    </div>
    
    <div th:if="*{estatusForro  == '1'}"  class="form-group col-sm-4">
        <label for="status">Forro Opcional 1</label>
        <select required class="form-control" data-live-search="true" th:field="*{auxiliar1}">
        	<option value=""  selected>Selecciona una..</option>
         	<option th:each="listForrosAutori: ${listForrosAutori}"
			th:value="${listForrosAutori.idForro}" th:text="${listForrosAutori.nombreForro}"></option>   
		</select>
    </div>
    
    
    <div th:if="*{estatusForro  == '1'}"  class="form-group col-sm-4">
        <label for="status">Forro Opcional 2</label>
        <select required class="form-control" data-live-search="true" th:field="*{auxiliar2}">
        	<option value=""  selected>Selecciona una..</option>
         	<option th:each="listForrosAutori: ${listForrosAutori}"
			th:value="${listForrosAutori.idForro}" th:text="${listForrosAutori.nombreForro}"></option>
		</select>
    </div>
    
    <div th:if="*{estatusForro  == '1'}"  class="form-group col-sm-4">
        <label for="status">Forro Opcional 3</label>
        <select required class="form-control" data-live-search="true" th:field="*{auxiliar3}">
        	<option value=""  selected>Selecciona una..</option>
         	<option th:each="listForrosAutori: ${listForrosAutori}"
			th:value="${listForrosAutori.idForro}" th:text="${listForrosAutori.nombreForro}"></option>
		</select>
    </div>
    
    <div  th:if="*{estatusForro == '1'}" class="col-sm-12">
        <div class="form-group p-3 border p-2 rounded m-3">
            <div class="row">
                <div class="col-sm-3 text-center pt-2 border-right">
                    <label for="mainImageForro"><img th:src="@{'/uploads/forros/'+*{foto}}"  th:onerror="this.src='/dist/img/preview.png'" alt="Placeholder" id="serviceImageForro" class="placeholder img-thumbnail" aria-describedby="imagePreviewHelp" /></label>
                    <small id="imagePreviewHelpForro" class="form-text text-muted">Previsualizaci&oacute;n de la imagen</small>
                </div>
                <div class="col">
                    <label for="mainImageForro">Forro</label>
                    <div class="input-group mb-3">
                        <input type="file" name="imagenForro" class="form-control border p-1" id="mainImageForro"  />
                        <div class="input-group-append">
                            <span class="input-group-text bg-danger text-danger pointer" id="clearUploadForro"><i class="fas fa-times"></i></span>
                        </div>
                    </div>
                    <small id="imageHelpForro" class="form-text text-muted">Selecciona la foto que desea subir.</small>
                </div>
            </div>
        </div>
    </div>
    
    <div class="form-group col-sm-12">
    <a th:href="@{/materiales}" class="btn btn-danger">Cancelar</a>
        <button onclick="arreglof()"  class="btn btn-primary next-step float-right"  type="submit">Guardar</button>
    </div>	
    <input name="txtTablaf" type="hidden" id="txtTablaf" value="">
    <input name="txtTabla2f" type="hidden" id="txtTabla2f" value="">
    
    <input  type="hidden" th:field="*{idForro}">
    <input  type="hidden" th:field="*{idText}">
    <input  type="hidden" th:field="*{idTextProspecto}">
    <input  type="hidden" th:field="*{creadoPor}">
    <input  type="hidden" th:field="*{actualizadoPor}">
    <input  type="hidden" th:field="*{fechaCreacion}">
    <input  type="hidden" th:field="*{ultimaFechaModificacion}">
     <input  type="hidden" th:field="*{estatusForro}">
     <input  type="hidden" th:field="*{estatus}">
    
</form>

<script>
function guardarf(){
	
	if( document.getElementById("telaComposicionf").value == null || 
			document.getElementById("telaComposicionf").value.length == 0 || 
			/^\s+$/.test(document.getElementById("telaComposicionf").value) ||
			 document.getElementById("telaFamcomposicionf").selectedIndex == null ||
			 document.getElementById("telaFamcomposicionf").selectedIndex == "" ) {
		Swal.fire({
	          position: 'center',
	          icon: 'error',
	          title: 'Complete los campos porcentaje o composicion',
	          showConfirmButton: false,
	          timer: 1250
	        });
		}
	
	else {
		  var telaComposicionf = document.getElementById("telaComposicionf").value;
		    var telaFamcomposicionf = document.getElementById("telaFamcomposicionf").value;    
		    var nombref = $( "#telaFamcomposicionf option:selected" ).text()
		    
		    var vali;
    		var aux;
    			$('#mytablef tr').each(function () {
    				vali= $(this).find('td').eq(1).html();
    				if ( vali == telaFamcomposicionf ){
    					aux=0;
    					Swal.fire({
    		          		position: 'center',
    		          		icon: 'error',
    		          		title: 'Ya ha seleccionado esa composicion',
    		          		showConfirmButton: false,
    		          		timer: 1250
    		        });
    		}
			
		 });
    		if (aux != 0){
		  		var i = 1; //contador para asignar id al boton que borrara la fila
		    	var fila = '<tr id="row' + i + '"><td>' + telaComposicionf + '</td> <td style="display:none;">' + telaFamcomposicionf + '</td> <td >' + nombref + '</td>  <td><button type="button" name="remove" id="' + i + '" onclick="eliminar(this)" class="btn btn-danger btn_remove">Quitar</button></td>   </tr>'; //esto seria lo que contendria la fila
		    	i++;
		    	$('#mytablef tr:first').after(fila);
		    	$("#adicionadosf").text(""); //esta instruccion limpia el div adicioandos para que no se vayan acumulando
		    	var nFilas = $("#mytablef tr").length;
		    	$("#adicionadosf").append(nFilas - 1);
		    	//le resto 1 para no contar la fila del header
		    	document.getElementById("telaComposicionf").value ="";
		    	document.getElementById("telaFamcomposicionf").value = '';
		  		$('#telaFamcomposicionf').change();
    		}
	}
	   
  
   
    
    
    
    
}
function eliminarf(t) {
	
	  var td = t.parentNode;
    var tr = td.parentNode;
    var table = tr.parentNode;
    table.removeChild(tr);
	 
	}
	
function arreglof() {
	valores=new Array();
	var compof="";
	var idfamf="" ;
	var contadorf=0;
	$('#mytablef tr').each(function () {
		compof=$(this).find('td').eq(0).html()+","+compof;
		if ( $(this).find('td').eq(0).html() != null ){
			var sumaf = $(this).find('td').eq(0).html();
			contadorf = (Number(contadorf) +Number(sumaf));
		}
		
		idfamf= $(this).find('td').eq(1).html()+","+idfamf;
	      
	  
	  document.getElementById("txtTablaf").value = compof;
	  document.getElementById("txtTabla2f").value = idfamf;
	  
	 });
	
	var formf = document.getElementById("forroForm");
	formf.onsubmit = function(e){
		if(contadorf == 100){
		}else{
			document.forroForm.telaComposicionf.focus()
			Swal.fire({
		          position: 'center',
		          icon: 'error',
		          title: 'Error es posible que el porcentaje no cumpla con el  100 % ',
		          showConfirmButton: false,
		          timer: 1300
		        });
			
		e.preventDefault();
		
		}
	}
	
	}

	
</script>
